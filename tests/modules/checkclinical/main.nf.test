// nf-test for check_clinical dependencies process
nextflow_process{
    name "Test module check_clinical"
    script "modules/local/checkclinical/main.nf"
    process "CHECK_CLINICAL"
    
    tag "modules"
    tag "modules_local"
    tag "modules/check_clinical"

    test("check clinical happy path") {

        when {
            process {
                """
                params.clinical_url = "https://submission.pcgl-dev.cumulus.genomeinformatics.org"
                params.file_manager_url = "https://file-manager.pcgl-dev.cumulus.genomeinformatics.org"
                // Test input with molecular metadata files (all TSV format)
                input[0] = ["EXAMPLE-CA"]
                input[1] = [file('${projectDir}/tests/modules/checkclinical/test_data/happy_path/Files.tsv')]
                input[2] = [file('${projectDir}/tests/modules/checkclinical/test_data/happy_path/Analysis.tsv')]
                input[3] = [file('${projectDir}/tests/modules/checkclinical/test_data/happy_path/Workflow.tsv')]
                input[4] = [file('${projectDir}/tests/modules/checkclinical/test_data/happy_path/Read_Group.tsv')]
                input[5] = [file('${projectDir}/tests/modules/checkclinical/test_data/happy_path/Experiment.tsv')]
                input[6] = [file('${projectDir}/tests/modules/checkclinical/test_data/happy_path/Specimen.tsv')]
                input[7] = [file('${projectDir}/tests/modules/checkclinical/test_data/happy_path/Sample.tsv')]
                input[8] = ['${projectDir}/tests/modules/checkclinical/test_data/happy_path']
                """
            }
        }

        then {
            assertAll(
                { assert process.success},
                { assert process.out.status},
                { assert process.out.status_yml},
                { assert process.out.versions},
            )
        }
    }
    test("check clinical bad path") {

        when {
            process {
                """
                params.clinical_url = "https://submission.pcgl-dev.cumulus.genomeinformatics.org"
                params.file_manager_url = "https://file-manager.pcgl-dev.cumulus.genomeinformatics.org"
                // Test input with molecular metadata files (all TSV format)
                input[0] = ["EXAMPLE-CA"]
                input[1] = [file('${projectDir}/tests/modules/checkclinical/test_data/bad_path/Files.tsv')]
                input[2] = [file('${projectDir}/tests/modules/checkclinical/test_data/bad_path/Analysis.tsv')]
                input[3] = [[]]
                input[4] = [[]]
                input[5] = [file('${projectDir}/tests/modules/checkclinical/test_data/bad_path/Experiment.tsv')]
                input[6] = [[]]
                input[7] = [[]]
                input[8] = ['${projectDir}/tests/modules/checkclinical/test_data/happy_path']
                """
            }
        }

        then {
            assertAll(
                { assert process.success},
                { assert process.out.status},
                { assert process.out.status_yml},
                { assert process.out.versions},
            )
        }
    }
}
